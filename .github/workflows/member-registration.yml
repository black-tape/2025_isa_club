name: æˆå‘˜ç™»è®°è‡ªåŠ¨å¤„ç†

on:
  issues:
    types: [opened, labeled]

jobs:
  welcome-member:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'æˆå‘˜ç™»è®°')

    steps:
      - name: æ¬¢è¿æ–°æˆå‘˜
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number;
            const issue_title = context.payload.issue.title;

            // è‡ªåŠ¨æ·»åŠ æ¬¢è¿è¯„è®º
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue_number,
              body: `ğŸ‘‹ æ¬¢è¿åŠ å…¥ISAç¤¾å›¢ï¼

æ„Ÿè°¢ä½ æäº¤æˆå‘˜ç™»è®°ä¿¡æ¯ï¼

âœ… æˆ‘ä»¬å·²ç»æ”¶åˆ°äº†ä½ çš„ä¿¡æ¯ï¼Œç®¡ç†å‘˜ä¼šå°½å¿«å®¡æ ¸ã€‚

ğŸ“Œ æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š
- å…³æ³¨ä»“åº“ä»¥è·å–æœ€æ–°åŠ¨æ€
- åŠ å…¥ç¤¾å›¢ç¾¤ç»„ä¸å¤§å®¶äº¤æµ
- æµè§ˆå…¶ä»–æˆå‘˜çš„æŠ€æœ¯æ–¹å‘
- æŸ¥çœ‹å³å°†å¼€å±•çš„æ´»åŠ¨

æœŸå¾…ä¸ä½ ä¸€èµ·å­¦ä¹ æˆé•¿ï¼ğŸš€`
            });

            console.log('æ¬¢è¿è¯„è®ºå·²æ·»åŠ ');

  auto-label:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.title, '[æˆå‘˜ç™»è®°]') || contains(github.event.issue.title, '[ç™»è®°]')

    steps:
      - name: è‡ªåŠ¨æ·»åŠ æ ‡ç­¾
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.issue.number;
            const issue_body = context.payload.issue.body || '';

            // è‡ªåŠ¨æ·»åŠ "æˆå‘˜ç™»è®°"æ ‡ç­¾
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue_number,
              labels: ['æˆå‘˜ç™»è®°', 'å¾…å®¡æ ¸']
            });

            // æ ¹æ®å†…å®¹è‡ªåŠ¨æ·»åŠ æŠ€æœ¯æ–¹å‘æ ‡ç­¾
            const techLabels = [];

            if (issue_body.includes('å‰ç«¯') || issue_body.includes('Web')) {
              techLabels.push('å‰ç«¯å¼€å‘');
            }
            if (issue_body.includes('åç«¯') || issue_body.includes('æœåŠ¡å™¨')) {
              techLabels.push('åç«¯å¼€å‘');
            }
            if (issue_body.includes('AI') || issue_body.includes('äººå·¥æ™ºèƒ½') || issue_body.includes('æœºå™¨å­¦ä¹ ')) {
              techLabels.push('äººå·¥æ™ºèƒ½');
            }
            if (issue_body.includes('æ•°æ®åˆ†æ') || issue_body.includes('æ•°æ®ç§‘å­¦')) {
              techLabels.push('æ•°æ®åˆ†æ');
            }
            if (issue_body.includes('ç½‘ç»œå®‰å…¨') || issue_body.includes('å®‰å…¨')) {
              techLabels.push('ç½‘ç»œå®‰å…¨');
            }
            if (issue_body.includes('åµŒå…¥å¼') || issue_body.includes('ç‰©è”ç½‘')) {
              techLabels.push('åµŒå…¥å¼');
            }

            if (techLabels.length > 0) {
              // éœ€è¦å…ˆåˆ›å»ºè¿™äº›æ ‡ç­¾ï¼Œæˆ–è€…ä½¿ç”¨try-catchå¤„ç†
              try {
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue_number,
                  labels: techLabels
                });
              } catch (error) {
                console.log('éƒ¨åˆ†æ ‡ç­¾å¯èƒ½ä¸å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º');
              }
            }

            console.log('æ ‡ç­¾å·²è‡ªåŠ¨æ·»åŠ ');
